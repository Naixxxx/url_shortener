# URL CLI Shortener

Консольное Java приложение для сокращения ссылок 

## Возможности

- Создавать короткие ссылки из длинных URL
- Получать уникальные короткие ссылки при каждом создании
- Устанавливать лимит переходов при создании ссылки или менять его позже
- Переходить по короткой ссылке через CLI 
- Автоматически блокировать ссылку после достижения лимита переходов
- Автоматически удалять протухшие ссылки по TTL 
- Мультипользовательский режим, несколько пользователей, у каждого несколько ссылок
- Управление доступом: удалить/изменить лимит может только владелец ссылки

---

## Требования

- Java 21+
- Maven 3.9+

---

## Конфигурационный файл для сервиса

```bash
# Префикс, показываемый пользователю (не настоящий внешний домен)
app.baseUrl=short

# TTL ссылки (в секундах).
app.ttlSeconds=86400

# Лимит переходов по умолчанию
app.defaultMaxClicks=3

# Интервал фоновой очистки протухших ссылок (в секундах)
app.cleanupIntervalSeconds=30

# Где хранить UUID текущего пользователя (относительно home)
app.userUuidFile=.url-shortener-cli/user.uuid
```

---

## Команды CLI
### Авторизация:
- `help` — показать подсказку со списком команд
- `whoami` — показать текущий UUID пользователя
- `exit` — выйти из приложения 

### Пользователи:
- `user` — показать текущего пользователя и подсказки с подкомандами
- `user new` — создать нового пользователя (новый UUID) и переключиться на него
- `user use <uuid>` — переключиться на существующий UUID 
- `logout` — алиас user new (создание нового пользователя и переключение)

### Ссылки:
- `create <url> [maxClicks]` — создать короткую ссылку на url (maxClicks необязательный параметр тк по дефолту используется из конфига)
- `open <shortUrl>` — перейти по короткой ссылке (инкрементится клик для TTL)
- `list` — показать список ссылок пользователя
- `delete <shortUrl>` — удалить ссылку (работает только для того UUID, который создал ее)
- `set-limit <shortUrl> <newLimit>` — изменить лимит переходов на ссылку (работает только для того UUID, который создал ее)

---

## Архитектура проекта
- cli/
    - CommandLoop — цикл чтения команд, обработка ввода/ошибок, вызовы сервисов
- core/
    - exceptions/ — кастомные исключения
    - models/ — доменные модели (ShortLink)
- repository/ — интерфейсы хранилищ (LinkRepository, UserUuidStore)
- infra/
    - cfg/
        - PropertiesAppConfig - чтение конфигурации из application.properties
    - InMemoryLinkRepository — in-memory хранилище ссылок
    - FileUserUuidStore — сохранение UUID текущего пользователя в файл
- services/
    - LinkService — создание ссылок, редирект, лимиты, права владельца
    - CleanupService — удаление протухших ссылок по TTL
    - UserService — создание и переключение UUID пользователя
    - CodeGenerator — генерация короткого кода
    - NotificationService/ConsoleNotificationService — уведомления в консоль
- Main — точка входа, сборка зависимостей и запуск CLI с фоновой очистки

---

## Пример сессии (команд)
```bash
whoami

create https://example.com 2
list

open example/tloIibVd 

set-limit example/tloIibVd 5

user new 
list
delete example/tloIibVd

# переходим обратно на старого пользователя
user use 123e4567-e89b-12d3-a456-426614174000
list
delete example/tloIibVd

exit 
```

---

## Запуск тестов
```bash
mvn test
```
